From f631eba6b78690029c7aec2bd458d5263f743bec Mon Sep 17 00:00:00 2001
From: Maxime Ripard <maxime.ripard@bootlin.com>
Date: Fri, 13 Jul 2018 11:02:42 +0200
Subject: [PATCH 46/55] fixup! media: cedrus: Add H264 decoding support

---
 drivers/media/platform/sunxi/cedrus/cedrus_h264.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/media/platform/sunxi/cedrus/cedrus_h264.c b/drivers/media/platform/sunxi/cedrus/cedrus_h264.c
index b735741360a0..55700b71d06c 100644
--- a/drivers/media/platform/sunxi/cedrus/cedrus_h264.c
+++ b/drivers/media/platform/sunxi/cedrus/cedrus_h264.c
@@ -93,14 +93,14 @@ static void cedrus_write_frame_list(struct cedrus_ctx *ctx,
 		const struct cedrus_buffer *cedrus_buf;
 		struct vb2_buffer *ref_buf;
 
-		if (!(dpb->flags & V4L2_H264_DPB_ENTRY_FLAG_ACTIVE))
-			continue;
-
 		ref_buf = ctx->dst_bufs[dpb->buf_index];
 		cedrus_buf = vb2_to_cedrus_buffer(ref_buf);
 		position = cedrus_buf->codec.h264.position;
 		used_dpbs |= BIT(position);
 
+		if (!(dpb->flags & V4L2_H264_DPB_ENTRY_FLAG_ACTIVE))
+			continue;
+
 		cedrus_fill_ref_pic(&pic_list[position], ref_buf, &ctx->dst_fmt,
 				    ctx->codec.h264.mv_col_buf_dma,
 				    ctx->codec.h264.mv_col_buf_size,
-- 
2.18.0

